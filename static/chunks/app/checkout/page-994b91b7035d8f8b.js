(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[285,727,213,434,142,858],{2601:function(e,t,r){"use strict";var n,s;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(s=r.g.process)?void 0:s.env)?r.g.process:r(8960)},9280:function(e,t,r){Promise.resolve().then(r.bind(r,3042))},3042:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return S}});var n=r(7437),s=r(3151),a=r(9166),o=r(4215),i=r(341),c=r(1490);let l=async e=>{try{let t=await fetch("/api/stripe",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(c.Z.get("token"))},body:JSON.stringify(e)});return await t.json()}catch(e){console.log(e)}};var d="https://js.stripe.com/v3",u=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,p=function(){for(var e=document.querySelectorAll('script[src^="'.concat(d,'"]')),t=0;t<e.length;t++){var r=e[t];if(u.test(r.src))return r}return null},h=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",r=document.createElement("script");r.src="".concat(d).concat(t);var n=document.head||document.body;if(!n)throw Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return n.appendChild(r),r},m=function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"1.54.1",startTime:t})},f=null,g=function(e,t,r){if(null===e)return null;var n=e.apply(void 0,t);return m(n,r),n},x=Promise.resolve().then(function(){return null!==f?f:f=new Promise(function(e,t){if("undefined"==typeof window||"undefined"==typeof document){e(null);return}if(window.Stripe,window.Stripe){e(window.Stripe);return}try{var r=p();r||(r=h(null)),r.addEventListener("load",function(){window.Stripe?e(window.Stripe):t(Error("Stripe.js not available"))}),r.addEventListener("error",function(){t(Error("Failed to load Stripe.js"))})}catch(e){t(e);return}})}),y=!1;x.catch(function(e){y||console.warn(e)});var v=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];y=!0;var n=Date.now();return x.then(function(e){return g(e,t,n)})},w=r(4033),j=r(2265),b=r(6535),N=r(171);function S(){let{cartItems:e,user:t,addresses:r,setAddresses:c,checkoutFormData:d,setCheckoutFormData:u}=(0,j.useContext)(a.GlobalContext),[p,h]=(0,j.useState)(null),[m,f]=(0,j.useState)(!1),[g,x]=(0,j.useState)(!1),y=(0,w.useRouter)(),S=(0,w.useSearchParams)(),T=v("pk_test_51NMv6ZSC6E6fnyMeRIEb9oEXdGRCC9yrBTT4xWHgcjWOuFcqFiAHErvaS50K1hl5t5WJXVGfLLWxvb705IWJhA3300yCcrMnlM");async function k(){let e=await (0,o.ar)(null==t?void 0:t._id);e.success&&c(e.data)}async function A(){let t=await T,r=e.map(e=>({price_data:{currency:"usd",product_data:{images:[e.productID.imageUrl],name:e.productID.name},unit_amount:100*e.productID.price},quantity:1})),n=await l(r);f(!0),localStorage.setItem("stripe",!0),localStorage.setItem("checkoutFormData",JSON.stringify(d));let{error:s}=await t.redirectToCheckout({sessionId:n.id});console.log(s)}return console.log(e),(0,j.useEffect)(()=>{null!==t&&k()},[t]),(0,j.useEffect)(()=>{(async function(){if(JSON.parse(localStorage.getItem("stripe"))&&"success"===S.get("status")&&e&&e.length>0){f(!0);let r=JSON.parse(localStorage.getItem("checkoutFormData")),n={user:null==t?void 0:t._id,shippingAddress:r.shippingAddress,orderItems:e.map(e=>({qty:1,product:e.productID})),paymentMethod:"Stripe",totalPrice:e.reduce((e,t)=>t.productID.price+e,0),isPaid:!0,isProcessing:!0,paidAt:new Date},s=await (0,i.mg)(n);s.success?(f(!1),x(!0),N.Am.success(s.message,{position:N.Am.POSITION.TOP_RIGHT})):(f(!1),x(!1),N.Am.error(s.message,{position:N.Am.POSITION.TOP_RIGHT}))}})()},[S.get("status"),e]),(console.log(d),(0,j.useEffect)(()=>{g&&setTimeout(()=>{y.push("/orders")},[2e3])},[g]),g)?(0,n.jsx)("section",{className:"h-screen bg-gray-200",children:(0,n.jsx)("div",{className:"mx-auto px-4 sm:px-6 lg:px-8",children:(0,n.jsx)("div",{className:"mx-auto mt-8 max-w-screen-xl px-4 sm:px-6 lg:px-8 ",children:(0,n.jsx)("div",{className:"bg-white shadow",children:(0,n.jsx)("div",{className:"px-4 py-6 sm:px-8 sm:py-10 flex flex-col gap-5",children:(0,n.jsx)("h1",{className:"font-bold text-lg",children:"Your payment is successfull and you will be redirected to orders page in 2 seconds !"})})})})})}):m?(0,n.jsx)("div",{className:"w-full min-h-screen flex justify-center items-center",children:(0,n.jsx)(b.Z,{color:"#000000",loading:m,size:30,"data-testid":"loader"})}):(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"grid sm:px-10 lg:grid-cols-2 lg:px-20 xl:px-32",children:[(0,n.jsxs)("div",{className:"px-4 pt-8",children:[(0,n.jsx)("p",{className:"font-medium text-xl",children:"Cart Summary"}),(0,n.jsx)("div",{className:"mt-8 space-y-3 rounded-lg border bg-white px-2 py-4 sm:px-5",children:e&&e.length?e.map(e=>(0,n.jsxs)("div",{className:"flex flex-col rounded-lg bg-white sm:flex-row",children:[(0,n.jsx)("img",{src:e&&e.productID&&e.productID.imageUrl,alt:"Cart Item",className:"m-2 h-24 w-28 rounded-md border object-cover object-center"}),(0,n.jsxs)("div",{className:"flex w-full flex-col px-4 py-4",children:[(0,n.jsx)("span",{className:"font-bold",children:e&&e.productID&&e.productID.name}),(0,n.jsx)("span",{className:"font-semibold",children:e&&e.productID&&e.productID.price})]})]},e._id)):(0,n.jsx)("div",{children:"Your cart is empty"})})]}),(0,n.jsxs)("div",{className:"mt-10 bg-gray-50 px-4 pt-8 lg:mt-0",children:[(0,n.jsx)("p",{className:"text-xl font-medium",children:"Shipping address details"}),(0,n.jsx)("p",{className:"text-gray-400 font-bold",children:"Complete your order by selecting address below"}),(0,n.jsx)("div",{className:"w-full mt-6 mr-0 mb-0 ml-0 space-y-6",children:r&&r.length?r.map(e=>(0,n.jsxs)("div",{onClick:()=>(function(e){if(e._id===p){h(null),u({...d,shippingAddress:{}});return}h(e._id),u({...d,shippingAddress:{...d.shippingAddress,fullName:e.fullName,city:e.city,country:e.country,postalCode:e.postalCode,address:e.address}})})(e),className:"border p-6 ".concat(e._id===p?"border-red-900":""),children:[(0,n.jsxs)("p",{children:["Name : ",e.fullName]}),(0,n.jsxs)("p",{children:["Address : ",e.address]}),(0,n.jsxs)("p",{children:["City : ",e.city]}),(0,n.jsxs)("p",{children:["Country : ",e.country]}),(0,n.jsxs)("p",{children:["PostalCode : ",e.postalCode]}),(0,n.jsx)("button",{className:"mt-5 mr-5 inline-block bg-black text-white px-5 py-3 text-xs font-medium uppercase tracking-wide",children:e._id===p?"Selected Address":"Select Address"})]},e._id)):(0,n.jsx)("p",{children:"No addresses added"})}),(0,n.jsx)("button",{onClick:()=>y.push("/account"),className:"mt-5 mr-5 inline-block bg-black text-white px-5 py-3 text-xs font-medium uppercase tracking-wide",children:"Add new address"}),(0,n.jsxs)("div",{className:"mt-6 border-t border-b py-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Subtotal"}),(0,n.jsxs)("p",{className:"text-lg font-bold text-gray-900",children:["$",e&&e.length?e.reduce((e,t)=>t.productID.price+e,0):"0"]})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Shipping"}),(0,n.jsx)("p",{className:"text-lg font-bold text-gray-900",children:"Free"})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Total"}),(0,n.jsxs)("p",{className:"text-lg font-bold text-gray-900",children:["$",e&&e.length?e.reduce((e,t)=>t.productID.price+e,0):"0"]})]}),(0,n.jsx)("div",{className:"pb-10",children:(0,n.jsx)("button",{disabled:e&&0===e.length||0===Object.keys(d.shippingAddress).length,onClick:A,className:"disabled:opacity-50 mt-5 mr-5 w-full  inline-block bg-black text-white px-5 py-3 text-xs font-medium uppercase tracking-wide",children:"Checkout"})})]})]})]}),(0,n.jsx)(s.Z,{})]})}},3151:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var n=r(7437),s=r(171);function a(){return(0,n.jsx)(s.Ix,{position:"top-right",autoClose:4e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light",rtl:!1})}r(8062)},9166:function(e,t,r){"use strict";r.r(t),r.d(t,{GlobalContext:function(){return i},default:function(){return u},initialCheckoutFormData:function(){return c}});var n=r(7437),s=r(1490),a=r(4033),o=r(2265);let i=(0,o.createContext)(null),c={shippingAddress:{},paymentMethod:"",totalPrice:0,isPaid:!1,paidAt:new Date,isProcessing:!0},l=["cart","checkout","account","orders","admin-view"],d=["/admin-view","/admin-view/add-product","/admin-view/all-products"];function u(e){let{children:t}=e,[r,u]=(0,o.useState)(!1),[p,h]=(0,o.useState)(!0),[m,f]=(0,o.useState)({loading:!1,id:""}),[g,x]=(0,o.useState)(null),[y,v]=(0,o.useState)(null),[w,j]=(0,o.useState)(null),[b,N]=(0,o.useState)(!1),[S,T]=(0,o.useState)([]),[k,A]=(0,o.useState)([]),[C,I]=(0,o.useState)({fullName:"",city:"",country:"",postalCode:"",address:""}),[E,O]=(0,o.useState)(c),[_,P]=(0,o.useState)([]),[D,Z]=(0,o.useState)(null),[B,L]=(0,o.useState)([]),z=(0,a.useRouter)(),J=(0,a.usePathname)();return(0,o.useEffect)(()=>{if(void 0!==s.Z.get("token")){x(!0);let e=JSON.parse(localStorage.getItem("user"))||{},t=JSON.parse(localStorage.getItem("cartItems"))||[];v(e),T(t)}else x(!1),v({})},[s.Z]),(0,o.useEffect)(()=>{"/register"!==J&&!J.includes("product")&&"/"!==J&&y&&0===Object.keys(y).length&&l.includes(J)>-1&&z.push("/login")},[y,J]),(0,o.useEffect)(()=>{null!==y&&y&&Object.keys(y).length>0&&(null==y?void 0:y.role)!=="admin"&&d.indexOf(J)>-1&&z.push("/unauthorized-page")},[y,J]),(0,n.jsx)(i.Provider,{value:{showNavmodel:r,setShowNavmodel:u,pageLevelLoader:p,setPageLevelLoader:h,isAuthUser:g,setIsAuthUser:x,user:y,setUser:v,componentLevelLoader:m,setComponentLevelLoader:f,currentUpdatedProduct:w,setCurrentUpdatedProduct:j,showCartModel:b,setShowCartModel:N,cartItems:S,setCartItems:T,addresses:k,setAddresses:A,addressFormData:C,setAddressFormData:I,checkoutFormData:E,setCheckoutFormData:O,allOrdersForUser:_,setAllOrdersForUser:P,orderDetails:D,setOrderDetails:Z,allOrdersForAllUsers:B,setAllOrdersForAllUsers:L},children:t})}},4215:function(e,t,r){"use strict";r.d(t,{AF:function(){return s},_N:function(){return i},ar:function(){return a},y3:function(){return o}});var n=r(1490);let s=async e=>{try{let t=await fetch("/api/address/add-new-address",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n.Z.get("token"))},body:JSON.stringify(e)});return await t.json()}catch(e){console.log(e)}},a=async e=>{try{let t=await fetch("/api/address/get-all-address?id=".concat(e),{method:"GET",headers:{Authorization:"Bearer ".concat(n.Z.get("token"))}});return await t.json()}catch(e){console.log(e)}},o=async e=>{try{let t=await fetch("/api/address/update-address",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n.Z.get("token"))},body:JSON.stringify(e)});return await t.json()}catch(e){console.log(e)}},i=async e=>{try{let t=await fetch("/api/address/delete-address?id=".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(n.Z.get("token"))}});return await t.json()}catch(e){console.log(e)}}},341:function(e,t,r){"use strict";r.d(t,{Bi:function(){return l},ax:function(){return o},mg:function(){return a},s$:function(){return i},wr:function(){return d}});var n=r(1490),s=r(2601);let a=async e=>{try{let t=await fetch("/api/order/create-order",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n.Z.get("token"))},body:JSON.stringify(e)});return await t.json()}catch(e){console.log(e)}},o=async e=>{try{let t=await fetch("/api/order/get-all-orders?id=".concat(e),{method:"GET",headers:{Authorization:"Bearer ".concat(n.Z.get("token"))}});return await t.json()}catch(e){console.log(e)}},i=async e=>{try{let t=await fetch("/api/order/order-details?id=".concat(e),{method:"GET",headers:{Authorization:"Bearer ".concat(n.Z.get("token"))}});return await t.json()}catch(e){console.log(e)}},c=s.env.NEXT_PUBLIC_API_URL||"http://localhost:3000",l=async()=>{try{let e=await fetch("".concat(c,"/api/admin/orders/get-all-orders"),{method:"GET",headers:{Authorization:"Bearer ".concat(n.Z.get("token"))}});return await e.json()}catch(e){console.log(" еее ама неска пих"),console.log(e)}},d=async e=>{try{let t=await fetch("".concat(c,"/api/admin/orders/update-order"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n.Z.get("token"))},body:JSON.stringify(e)});return await t.json()}catch(e){console.log(e)}}},8062:function(){},8960:function(e){!function(){var t={229:function(e){var t,r,n,s=e.exports={};function a(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var c=[],l=!1,d=-1;function u(){l&&n&&(l=!1,n.length?c=n.concat(c):d=-1,c.length&&p())}function p(){if(!l){var e=i(u);l=!0;for(var t=c.length;t;){for(n=c,c=[];++d<t;)n&&n[d].run();d=-1,t=c.length}n=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new h(e,t)),1!==c.length||l||i(p)},h.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},r={};function n(e){var s=r[e];if(void 0!==s)return s.exports;var a=r[e]={exports:{}},o=!0;try{t[e](a,a.exports,n),o=!1}finally{o&&delete r[e]}return a.exports}n.ab="//";var s=n(229);e.exports=s}()}},function(e){e.O(0,[788,971,938,744],function(){return e(e.s=9280)}),_N_E=e.O()}]);