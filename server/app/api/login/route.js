"use strict";(()=>{var e={};e.id=5740,e.ids=[5740],e.modules={46517:e=>{e.exports=require("lodash")},11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},2276:(e,r,s)=>{s.r(r),s.d(r,{headerHooks:()=>j,originalPathname:()=>S,patchFetch:()=>Z,requestAsyncStorage:()=>q,routeModule:()=>v,serverHooks:()=>y,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>P});var o={};s.r(o),s.d(o,{POST:()=>x,dynamic:()=>h});var t=s(95419),a=s(69108),i=s(99678),n=s(82338),u=s(88582),l=s(6521),c=s(68619),m=s.n(c),d=s(46082),p=s.n(d),g=s(78070);let f=m().object({email:m().string().email().required(),password:m().string().required()}),h="force-dynamic";async function x(e){await (0,n.Z)();let{email:r,password:s}=await e.json(),{error:o}=f.validate({email:r,password:s});if(o)return g.Z.json({success:!1,message:o.details[0].message});try{let e=await u.Z.findOne({email:r});if(!e)return g.Z.json({success:!1,message:"Не открихме акаунт с този email."});if(!await (0,l.compare)(s,e.password))return g.Z.json({success:!1,message:"Грешна парола! Моля опитайте отново!"});let o={token:p().sign({id:e._id,email:e?.email,role:e?.role},"default_secret_key",{expiresIn:"1d"}),user:{email:e.email,name:e.name,_id:e._id,role:e.role}};return g.Z.json({success:!0,message:"Влязохте успешно!",finalData:o})}catch(e){return console.log("Нещо се обърка, моля опитайте отново!"),g.Z.json({success:!1,message:"Нещо се обърка, моля опитайте отново!"})}}let v=new t.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/login/route",pathname:"/api/login",filename:"route",bundlePath:"app/api/login/route"},resolvedPagePath:"D:\\Programming\\E-commerce App w NextJS\\ecommerce - Copy\\src\\app\\api\\login\\route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:q,staticGenerationAsyncStorage:w,serverHooks:y,headerHooks:j,staticGenerationBailout:P}=v,S="/api/login/route";function Z(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:w})}},82338:(e,r,s)=>{s.d(r,{Z:()=>i});var o=s(11185),t=s.n(o);let a={useNewUrlParser:!0,useUnifiedTopology:!0},i=async()=>{t().connect("mongodb+srv://burov96:123456782023@cluster0.p1f5hzv.mongodb.net/",a).then(()=>console.log("Успешна връзка с база данни!")).catch(e=>console.log(`Получихте следното съобщение от база данни : ${e.message}`))}},88582:(e,r,s)=>{s.d(r,{Z:()=>i});var o=s(11185),t=s.n(o);let a=new(t()).Schema({name:String,email:String,password:String,role:String}),i=t().models.User||t().model("User",a)}};var r=require("../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),o=r.X(0,[1638,6206,6082,734,6521],()=>s(2276));module.exports=o})();