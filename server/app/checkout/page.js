(()=>{var e={};e.id=285,e.ids=[285],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},71017:e=>{"use strict";e.exports=require("path")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},10786:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>d,routeModule:()=>m,tree:()=>l});var r=s(50482),a=s(69108),o=s(62563),i=s.n(o),n=s(68300),c={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);s.d(t,c);let l=["",{children:["checkout",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,69530)),"D:\\Programming\\E-commerce App w NextJS\\ecommerce - Copy\\src\\app\\checkout\\page.js"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,89374)),"D:\\Programming\\E-commerce App w NextJS\\ecommerce - Copy\\src\\app\\layout.js"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,69361,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["D:\\Programming\\E-commerce App w NextJS\\ecommerce - Copy\\src\\app\\checkout\\page.js"],p="/checkout/page",u={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/checkout/page",pathname:"/checkout",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},92796:(e,t,s)=>{Promise.resolve().then(s.bind(s,53038))},53038:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>w});var r=s(95344),a=s(79510),o=s(46859),i=s(66412),n=s(96211),c=s(8014);let l=async e=>{try{let t=await fetch("/api/stripe",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c.Z.get("token")}`},body:JSON.stringify(e)});return await t.json()}catch(e){console.log(e)}};var d=function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"1.54.1",startTime:t})},p=null,u=function(e,t,s){if(null===e)return null;var r=e.apply(void 0,t);return d(r,s),r},m=Promise.resolve().then(function(){return null!==p?p:p=new Promise(function(e,t){e(null)})}),h=!1;m.catch(function(e){h||console.warn(e)});var x=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];h=!0;var r=Date.now();return m.then(function(e){return u(e,t,r)})},g=s(22254),y=s(3729),f=s(7732),j=s(1208);function w(){let{cartItems:e,user:t,addresses:s,setAddresses:c,checkoutFormData:d,setCheckoutFormData:p}=(0,y.useContext)(o.GlobalContext),[u,m]=(0,y.useState)(null),[h,w]=(0,y.useState)(!1),[b,N]=(0,y.useState)(!1),v=(0,g.useRouter)(),P=(0,g.useSearchParams)(),k=x("pk_test_51NMv6ZSC6E6fnyMeRIEb9oEXdGRCC9yrBTT4xWHgcjWOuFcqFiAHErvaS50K1hl5t5WJXVGfLLWxvb705IWJhA3300yCcrMnlM");async function A(){let e=await (0,i.ar)(t?._id);e.success&&c(e.data)}async function _(){let t=await k,s=e.map(e=>({price_data:{currency:"usd",product_data:{images:[e.productID.imageUrl],name:e.productID.name},unit_amount:100*e.productID.price},quantity:1})),r=await l(s);w(!0),localStorage.setItem("stripe",!0),localStorage.setItem("checkoutFormData",JSON.stringify(d));let{error:a}=await t.redirectToCheckout({sessionId:r.id});console.log(a)}return console.log(e),(0,y.useEffect)(()=>{null!==t&&A()},[t]),(0,y.useEffect)(()=>{(async function(){if(JSON.parse(localStorage.getItem("stripe"))&&"success"===P.get("status")&&e&&e.length>0){w(!0);let s=JSON.parse(localStorage.getItem("checkoutFormData")),r={user:t?._id,shippingAddress:s.shippingAddress,orderItems:e.map(e=>({qty:1,product:e.productID})),paymentMethod:"Stripe",totalPrice:e.reduce((e,t)=>t.productID.price+e,0),isPaid:!0,isProcessing:!0,paidAt:new Date},a=await (0,n.mg)(r);a.success?(w(!1),N(!0),j.Am.success(a.message,{position:j.Am.POSITION.TOP_RIGHT})):(w(!1),N(!1),j.Am.error(a.message,{position:j.Am.POSITION.TOP_RIGHT}))}})()},[P.get("status"),e]),(console.log(d),(0,y.useEffect)(()=>{b&&setTimeout(()=>{v.push("/orders")},[2e3])},[b]),b)?r.jsx("section",{className:"h-screen bg-gray-200",children:r.jsx("div",{className:"mx-auto px-4 sm:px-6 lg:px-8",children:r.jsx("div",{className:"mx-auto mt-8 max-w-screen-xl px-4 sm:px-6 lg:px-8 ",children:r.jsx("div",{className:"bg-white shadow",children:r.jsx("div",{className:"px-4 py-6 sm:px-8 sm:py-10 flex flex-col gap-5",children:r.jsx("h1",{className:"font-bold text-lg",children:"Your payment is successfull and you will be redirected to orders page in 2 seconds !"})})})})})}):h?r.jsx("div",{className:"w-full min-h-screen flex justify-center items-center",children:r.jsx(f.Z,{color:"#000000",loading:h,size:30,"data-testid":"loader"})}):(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"grid sm:px-10 lg:grid-cols-2 lg:px-20 xl:px-32",children:[(0,r.jsxs)("div",{className:"px-4 pt-8",children:[r.jsx("p",{className:"font-medium text-xl",children:"Cart Summary"}),r.jsx("div",{className:"mt-8 space-y-3 rounded-lg border bg-white px-2 py-4 sm:px-5",children:e&&e.length?e.map(e=>(0,r.jsxs)("div",{className:"flex flex-col rounded-lg bg-white sm:flex-row",children:[r.jsx("img",{src:e&&e.productID&&e.productID.imageUrl,alt:"Cart Item",className:"m-2 h-24 w-28 rounded-md border object-cover object-center"}),(0,r.jsxs)("div",{className:"flex w-full flex-col px-4 py-4",children:[r.jsx("span",{className:"font-bold",children:e&&e.productID&&e.productID.name}),r.jsx("span",{className:"font-semibold",children:e&&e.productID&&e.productID.price})]})]},e._id)):r.jsx("div",{children:"Your cart is empty"})})]}),(0,r.jsxs)("div",{className:"mt-10 bg-gray-50 px-4 pt-8 lg:mt-0",children:[r.jsx("p",{className:"text-xl font-medium",children:"Shipping address details"}),r.jsx("p",{className:"text-gray-400 font-bold",children:"Complete your order by selecting address below"}),r.jsx("div",{className:"w-full mt-6 mr-0 mb-0 ml-0 space-y-6",children:s&&s.length?s.map(e=>(0,r.jsxs)("div",{onClick:()=>(function(e){if(e._id===u){m(null),p({...d,shippingAddress:{}});return}m(e._id),p({...d,shippingAddress:{...d.shippingAddress,fullName:e.fullName,city:e.city,country:e.country,postalCode:e.postalCode,address:e.address}})})(e),className:`border p-6 ${e._id===u?"border-red-900":""}`,children:[(0,r.jsxs)("p",{children:["Name : ",e.fullName]}),(0,r.jsxs)("p",{children:["Address : ",e.address]}),(0,r.jsxs)("p",{children:["City : ",e.city]}),(0,r.jsxs)("p",{children:["Country : ",e.country]}),(0,r.jsxs)("p",{children:["PostalCode : ",e.postalCode]}),r.jsx("button",{className:"mt-5 mr-5 inline-block bg-black text-white px-5 py-3 text-xs font-medium uppercase tracking-wide",children:e._id===u?"Selected Address":"Select Address"})]},e._id)):r.jsx("p",{children:"No addresses added"})}),r.jsx("button",{onClick:()=>v.push("/account"),className:"mt-5 mr-5 inline-block bg-black text-white px-5 py-3 text-xs font-medium uppercase tracking-wide",children:"Add new address"}),(0,r.jsxs)("div",{className:"mt-6 border-t border-b py-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Subtotal"}),(0,r.jsxs)("p",{className:"text-lg font-bold text-gray-900",children:["$",e&&e.length?e.reduce((e,t)=>t.productID.price+e,0):"0"]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Shipping"}),r.jsx("p",{className:"text-lg font-bold text-gray-900",children:"Free"})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Total"}),(0,r.jsxs)("p",{className:"text-lg font-bold text-gray-900",children:["$",e&&e.length?e.reduce((e,t)=>t.productID.price+e,0):"0"]})]}),r.jsx("div",{className:"pb-10",children:r.jsx("button",{disabled:e&&0===e.length||0===Object.keys(d.shippingAddress).length,onClick:_,className:"disabled:opacity-50 mt-5 mr-5 w-full  inline-block bg-black text-white px-5 py-3 text-xs font-medium uppercase tracking-wide",children:"Checkout"})})]})]})]}),r.jsx(a.Z,{})]})}},79510:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var r=s(95344),a=s(1208);function o(){return r.jsx(a.Ix,{position:"top-right",autoClose:4e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light",rtl:!1})}s(45996)},66412:(e,t,s)=>{"use strict";s.d(t,{AF:()=>a,_N:()=>n,ar:()=>o,y3:()=>i});var r=s(8014);let a=async e=>{try{let t=await fetch("/api/address/add-new-address",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.Z.get("token")}`},body:JSON.stringify(e)});return await t.json()}catch(e){console.log(e)}},o=async e=>{try{let t=await fetch(`/api/address/get-all-address?id=${e}`,{method:"GET",headers:{Authorization:`Bearer ${r.Z.get("token")}`}});return await t.json()}catch(e){console.log(e)}},i=async e=>{try{let t=await fetch("/api/address/update-address",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.Z.get("token")}`},body:JSON.stringify(e)});return await t.json()}catch(e){console.log(e)}},n=async e=>{try{let t=await fetch(`/api/address/delete-address?id=${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${r.Z.get("token")}`}});return await t.json()}catch(e){console.log(e)}}},96211:(e,t,s)=>{"use strict";s.d(t,{Bi:()=>c,ax:()=>o,mg:()=>a,s$:()=>i,wr:()=>l});var r=s(8014);let a=async e=>{try{let t=await fetch("/api/order/create-order",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.Z.get("token")}`},body:JSON.stringify(e)});return await t.json()}catch(e){console.log(e)}},o=async e=>{try{let t=await fetch(`/api/order/get-all-orders?id=${e}`,{method:"GET",headers:{Authorization:`Bearer ${r.Z.get("token")}`}});return await t.json()}catch(e){console.log(e)}},i=async e=>{try{let t=await fetch(`/api/order/order-details?id=${e}`,{method:"GET",headers:{Authorization:`Bearer ${r.Z.get("token")}`}});return await t.json()}catch(e){console.log(e)}},n=process.env.NEXT_PUBLIC_API_URL||"http://localhost:3000",c=async()=>{try{let e=await fetch(`${n}/api/admin/orders/get-all-orders`,{method:"GET",headers:{Authorization:`Bearer ${r.Z.get("token")}`}});return await e.json()}catch(e){console.log(" еее ама неска пих"),console.log(e)}},l=async e=>{try{let t=await fetch(`${n}/api/admin/orders/update-order`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.Z.get("token")}`},body:JSON.stringify(e)});return await t.json()}catch(e){console.log(e)}}},69530:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>o,__esModule:()=>a,default:()=>i});let r=(0,s(86843).createProxy)(String.raw`D:\Programming\E-commerce App w NextJS\ecommerce - Copy\src\app\checkout\page.js`),{__esModule:a,$$typeof:o}=r,i=r.default},73881:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});var r=s(70337);let a=e=>[{type:"image/x-icon",sizes:"16x16",url:(0,r.fillMetadataSegment)(".",e.params,"favicon.ico")+""}]},45996:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[1638,5872,337,5075],()=>s(10786));module.exports=r})();